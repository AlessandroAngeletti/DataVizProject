---
title: "Session 7 Clustering Workshop"
author: "Group 13 - Alessandro Angeletti, Zichen Wang, Johanna Jeffery, Nitya Chopra and Christopher Lewis"
date: "`r Sys.Date()`"
output: 
    html_document:
      number_sections: true
      highlight: haddock
      theme: spacelab
      toc: yes
      toc_depth: 2
      toc_float:
        collapsed: false
      fontzize: 10 pt
---

```{r, setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
# Load the relevant libraries
library(tidyverse)
library(lubridate)
library(mice) 
library(VIM)
library(dplyr)
library(Hmisc)
library(janitor)
library(readxl)
library(skimr)
```

# Background

why are we visualizing this dataset? what do we want to get out of it?

# Load & inspect Data

We would like to inspect the dataset in the following orders:

1) missing, empty, and duplicated values;
1) data types;
1) weird values, errors, and outliers.

```{r, load / inspect data, cache = TRUE}
# 1. Load the data
original_data <- vroom::vroom("winemag-data-130k-v2.csv") %>% 
  clean_names() %>% 
  select(-x1) # Discard an irrelevant column

# Take a look at the raw data
head(original_data)

# Check for missing values
#skim(original_data)
describe(original_data) 

# Check for duplicates
get_dupes(original_data)

# Check data types
glimpse(original_data)

# Check for errors and outliers
ggplot(original_data, aes(x = price)) +
  geom_boxplot()
ggplot(original_data, aes(x = price)) +
  geom_histogram(binwidth = 20)
ggplot(original_data, aes(x = points)) +
  geom_boxplot()
```

Through the inspection, we find:

> *Missing, empty, and duplicated values:*

- `country`: 63 blanks, why missing? should we fix it or not? how to fix it?
- `designation`: 
- `region_1`:
- `region_2`:
- `taster_name`:
- `taster_twitter_handle`:
- `variety`: 1 blank, 

> *data type:*

- `country`: should be a catergorical variable.
- 

> *weird values, errors, and outliers:*

- `price` appears to have an outlier.
- `points` falls in a reasonal range between 80 and 100, which does not need to be further modified.

## Clean data

This section will follow the order of the previous section and aim to fix the flaws to ease the further visualization.

### Resolve the missing values 

```{r, clean data 1}
# While trying to fix the missing countries with another locator
# We find that all observations missing country values have unique winery values
# List of all wineries for entries with no country.
wineries_na_country <- original_data %>% 
  filter(is.na(country)) %>% 
  summarise(winery) %>% 
  distinct()

# As some of the wineries in the above list have countries in other entries
# We can use the above list to fill the missing countries with the same wineries
# And the missing countries to the remaining incomparable wineries will be manually searched
wineries_countrymatch <- inner_join(original_data, wineries_na_country, by = "winery") %>%
  group_by(winery, country) %>% 
  summarise(country, winery) %>% 
  distinct()

# Load the manually completed list of countries with wineries
wineries_countryfinal <- read.csv("Winery_Country_List.csv", header = TRUE)

# Create a copy of the raw data to clean
clean1 <- original_data

# Fill the missing countries with our final list by wineries 
clean1$country[is.na(clean1$country)] <- wineries_countryfinal$country[match(clean1$winery, wineries_countryfinal$winery)][which(is.na(clean1$country))]

# Check the new status of missing values
skim(clean1$country)

# Find out the one missing value in variety(grape type)
variety_na <- clean1 %>% 
  filter(is.na(variety))

# While the other information for this observation is incomparable
# We find a trace of grape type in the description
# The missing grape type is "Petite Sirah"
clean1 <- clean1 %>% 
  mutate(variety = case_when(title == "Carmen 1999  (Maipo Valley)" ~ "Petite Sirah",
                            TRUE ~ variety ))
skim(clean1$variety)
```

